version: "3"

tasks:
  get-submission-address:
    desc: "Get the operator update handler from the middleware deploy JSON file"
    vars:
      SOURCE_CHAIN_NUMBER: 1 # changing this is not supported yet
      JSON_FILEPATH:
        sh: cd "{{.REPO_ROOT}}" && task middleware:get-json-filepath CHAIN_NUMBER={{.SOURCE_CHAIN_NUMBER}} PROJECT={{.PROJECT}} SERVICE_NAME={{.PROJECT}}
    requires:
      vars: [PROJECT]
    cmds:
      - sh -c 'jq -r ".addresses.operatorUpdateHandler // empty" "{{.JSON_FILEPATH}}" 2>/dev/null || true'

  get-evm-chain-names:
    desc: "Get the chain name config"
    vars:
      CHAIN_NAME:
        sh: cd "{{.REPO_ROOT}}" && task backend:get-chain-name-1
    cmds:
      - echo "{{.CHAIN_NAME}}"

  get-evm-service-handlers:
    desc: "Get comma-separated service handler addresses"
    vars:
      CHAIN_NAME:
        sh: cd "{{.REPO_ROOT}}" && task backend:get-chain-name-1
      SUBMISSION_ADDRESS:
        sh: task get-submission-address
    cmds:
      - echo "evm_service_handler_{{.CHAIN_NAME}}={{.SUBMISSION_ADDRESS}}"
