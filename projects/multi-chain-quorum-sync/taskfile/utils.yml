version: "3"

tasks:
  get-submission-address-*:
    desc: "Gets the submission address for a chain"
    vars:
      CHAIN_NUMBER: "{{index .MATCH 0}}"
      OUT_DIR:
        sh: cd "{{.REPO_ROOT}}" && task middleware:get-output-dir CHAIN_NUMBER={{.CHAIN_NUMBER}} PROJECT={{.PROJECT}} SERVICE_NAME={{.PROJECT}}
      MIRROR_PATH: "{{.OUT_DIR}}/mirror.json"
    preconditions:
      - test -f {{.MIRROR_PATH}}
    cmds:
      - |
        jq -r '.addresses.quorumSyncHandler' "{{.MIRROR_PATH}}"
