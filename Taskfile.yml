version: "3"

vars:
  COMPONENTS_DIR: "./components"
  SUDO:
    sh: |
      if groups | grep -q docker; then echo ""; else echo "sudo"; fi
  WAVS_CMD:
    sh: |
      ENV_FLAG=""
      if test -f {{.ENV_FILE}}; then
        ENV_FLAG="--env-file ./{{.ENV_FILE}}"
      fi
      echo "{{.SUDO}} docker run --rm --network host $ENV_FLAG -v $(pwd):/data {{.WAVS_DOCKER_IMAGE}} wavs-cli"

includes:
  avs_sync: ./avs_sync/Taskfile.yml

tasks:
  up:
    desc: Start all services with Docker Compose
    cmds:
      - docker compose up -d

  down:
    desc: Stop and remove all services
    cmds:
      - docker compose down

  restart:
    desc: Restart all services
    cmds:
      - task: down
      - task: up
