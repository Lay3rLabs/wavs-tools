version: "3"

tasks:
  clean:
    desc: "Clean up middleware nodes directory for a given service"
    vars:
      CHAIN_NUMBER: '{{.CHAIN_NUMBER | default "1"}}'
      NODES_DIR:
        sh: cd "{{.REPO_ROOT}}" && task middleware:get-output-dir CHAIN_NUMBER={{.CHAIN_NUMBER}} PROJECT={{.PROJECT}} SERVICE_NAME={{.SERVICE_NAME}}
    requires:
      vars: [PROJECT, SERVICE_NAME]
    cmds:
      - |
        echo "Cleaning up middleware nodes directory: {{.NODES_DIR}}"
      - rm -rf {{.NODES_DIR}}
