services:
  anvil:
    container_name: "anvil"
    image: "ghcr.io/foundry-rs/foundry:latest"
    stop_signal: SIGKILL
    network_mode: "host"
    command: ["anvil --fork-url ${ANVIL_RPC_URL} --port ${ANVIL_PORT}"]

  wavs:
    container_name: "wavs"
    image: "ghcr.io/lay3rlabs/wavs:0.4.0-rc"
    stop_signal: SIGKILL
    network_mode: "host"
    env_file: "../.env"
    command: ["wavs", "--home", "/wavs-home"]
    volumes:
      - "./wavs-home:/wavs-home"

  aggregator:
    container_name: "wavs-aggregator"
    image: "ghcr.io/lay3rlabs/wavs:0.4.0-rc"
    depends_on: ["wavs"]
    stop_signal: SIGKILL
    env_file: "../.env"
    command: ["wavs-aggregator", "--home", "/wavs-home"]
    volumes:
      - "./wavs-home:/wavs-home"
    network_mode: "host"

  jaeger:
    container_name: wavs-jaeger
    depends_on: ["wavs"]
    image: jaegertracing/jaeger:2.5.0
    network_mode: "host"
    stop_signal: SIGKILL
    environment:
      - COLLECTOR_OTLP_ENABLED=true
    # ports managed by host network mode

  # Prometheus is used to display metrics
  prometheus:
    container_name: wavs-prometheus
    depends_on: ["wavs"]
    image: prom/prometheus:v3.3.0
    network_mode: "host"
    stop_signal: SIGKILL
    # ports managed by host network mode
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    command:
      - "--config.file=/etc/prometheus/prometheus.yml"
      - "--web.enable-otlp-receiver"
